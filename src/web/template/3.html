<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Профиль экскурсовода</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Остальная часть HTML остается без изменений -->
    <!-- Индикатор загрузки -->
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
    </div>

    <div class="container">
        <!-- Шапка -->
        <div class="header">
            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/Coat_of_arms_of_Abkhazia.svg/430px-Coat_of_arms_of_Abkhazia.svg.png" alt="Герб">
            <div class="header-text">
                РЕЕСТР АТТЕСТОВАННЫХ ЭКСКУРСОВОДОВ, ОСУЩЕСТВЛЯЮЩИХ ДЕЯТЕЛЬНОСТЬ НА ТЕРРИТОРИИ РЕСПУБЛИКИ АБХАЗИЯ
            </div>
        </div>

        <!-- Кнопки -->
        <div class="button-group">
            <a href="/" class="button">Вернуться к реестру</a>
            <a href="#" class="button">Распечатать профиль</a>
            <a href="#" class="button">Проверить лицензию</a>
            <a href="#" class="button">Сообщить об ошибке</a>
        </div>

        <!-- Карточка профиля -->
        <div class="profile-card">
            <div class="profile-header">
                <div class="avatar-container">
                    <img class="profile-avatar" style="display: none;">
                    <div class="profile-avatar-initials"></div>
                </div>
                <div>
                    <h1 class="profile-title">Загрузка...</h1>
                    <p class="profile-subtitle">Загрузка...</p>
                    <div id="badges-container">
                        <span class="badge">Загрузка...</span>
                    </div>
                </div>
            </div>

            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Телефон</span>
                    <div class="info-value">Загрузка...</div>
                </div>

                <div class="info-item">
                    <span class="info-label">Категория</span>
                    <div class="info-value">Загрузка...</div>
                </div>

                <div class="info-item">
                    <span class="info-label">Лицензирующий орган</span>
                    <div class="info-value">Загрузка...</div>
                </div>

                <div class="info-item">
                    <span class="info-label">Номер реестровой записи</span>
                    <div class="info-value">Загрузка...</div>
                </div>
            </div>
        </div>

        <!-- Секция маршрутов -->
        <div class="profile-card">
            <h3 style="margin-top: 0; color: var(--primary-color);">Маршруты экскурсий</h3>

            <div class="route-card">
                <div class="route-title">
                    Основной маршрут
                    <span class="route-number">№ в группе: 1</span>
                </div>
                <div class="route-points">
                    <span class="route-point">Загрузка...</span>
                </div>
            </div>
        </div>

        <!-- Дополнительная информация -->
        <div class="profile-card">
            <h3 style="margin-top: 0; color: var(--primary-color);">Дополнительная информация</h3>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">ИНН</span>
                    <div class="info-value">Загрузка...</div>
                </div>

                <div class="info-item">
                    <span class="info-label">Способ сдачи экзамена</span>
                    <div class="info-value">Загрузка...</div>
                </div>

                <div class="info-item">
                    <span class="info-label">Тип лица</span>
                    <div class="info-value">Загрузка...</div>
                </div>

                <div class="info-item">
                    <span class="info-label">Дата выдачи лицензии</span>
                    <div class="info-value">Загрузка...</div>
                </div>
            </div>
        </div>

        <!-- История изменений -->
        <div class="profile-card">
            <h3 style="margin-top: 0; color: var(--primary-color);">История изменений</h3>

            <div class="info" id="history-container">
                <div class="info-item">
                    <span class="info-label">Загрузка...</span>
                    <div class="info-value">Загрузка...</div>
                </div>
            </div>
        </div>

        <!-- Футер -->
        <div class="footer">
            <div class="footer-content">
                <a href="#">Политика конфиденциальности</a>
                <a href="mailto:contact@abkhazia-tour.ru">contact@abkhazia-tour.ru</a>
                <a href="tel:+79409991111">+7 (940) 999-11-11</a>
            </div>
        </div>
    </div>

<script>
// Имитация базы данных экскурсоводов
const guidesDatabase = {
    "U191KK": {
        id: "U191KK",
        fullName: "Абанос Астамур Русланович",
        photoProfile: "https://img.freepik.com/free-photo/close-up-shot-serious-looking-handsome-adult-european-man-with-red-hair-beard-staring-with-focused-determined-expression-standing-strict-pose-gray-wall_176420-27574.jpg?t=st=1743933775~exp=1743937375~hmac=962096c06812fd48366a04e537080bd062975393b7bbb4e4ffa8a6d8f81c2b19&w=996",
        category: "Первая категория",
        license: {
            number: "№ 8368 от 03.10.2022 г.",
            issuingAuthority: "Министерство туризма Республики Абхазия",
            issueDate: "05.10.2022",
            status: "Отозвана"
        },
        tags: ["Исторические экскурсии", "Природные маршруты"],
        contacts: {
            phone: "7940-997-09-79",
            email: "",
            address: ""
        },
        routes: [
            {
                id: 1,
                name: "Основной маршрут",
                groupNumber: "№ в группе: 1",
                points: [
                    "пос. Гячрыпш",
                    "г. Гагра",
                    "г. Пицунда",
                    "оз. Рица",
                    "г. Н. Афон",
                    "пос. Гячрыпш"
                ]
            }
        ],
        additionalInfo: {
            inn: "123456789012",
            examType: "Очный (теория + практика)",
            entityType: "Физическое лицо"
        },
        history: [
            { date: "12.07.2023", action: "Добавлен в реестр" },
            { date: "15.08.2023", action: "Номер телефона обновлён" },
            { date: "20.09.2023", action: "ФИО было обновлено" },
            { date: "01.10.2023", action: "Добавлен новый маршрут" }
        ]
    }
};

// Функция для получения данных экскурсовода
function getGuideById(guideId) {
    return new Promise((resolve, reject) => {
        const guide = guidesDatabase[guideId];
        if (guide) {
            const processedGuide = processEmptyFields(guide);
            resolve(processedGuide);
        } else {
            reject(new Error("Экскурсовод с указанным ID не найден"));
        }
    });
}

// Функция для обработки пустых полей
function processEmptyFields(data) {
    const processed = JSON.parse(JSON.stringify(data));
    function process(obj) {
        for (const key in obj) {
            if (obj[key] === null || obj[key] === undefined || obj[key] === "") {
                obj[key] = "Нет данных";
            } else if (typeof obj[key] === "object") {
                process(obj[key]);
            }
        }
    }
    process(processed);
    return processed;
}

// Функция для обновления интерфейса
function updateUI(guide) {
    const isLicenseRevoked = guide.license.status === "Отозвана";

    // Добавляем уведомление об отозванной лицензии
    if (isLicenseRevoked) {
        const warningBanner = document.createElement('div');
        warningBanner.className = 'license-warning';
        warningBanner.innerHTML = `
            <div class="license-warning-content">
                <strong>Внимание!</strong> Лицензия данного экскурсовода была отозвана.
                Проведение экскурсий запрещено.
            </div>
        `;
        document.querySelector('.container').insertBefore(warningBanner, document.querySelector('.profile-card'));
    }

    // 1. Обновляем основную информацию
    safeSetText('.profile-title', guide.fullName);
    safeSetText('.profile-subtitle', `ID: ${guide.id} | Экскурсовод ${guide.category.toLowerCase()}`);

    // 2. Обновляем аватар
    const avatar = document.querySelector('.profile-avatar');
    if (avatar) {
        if (guide.photoProfile) {
            // Если есть URL фото, используем его
            avatar.src = guide.photoProfile;
            avatar.alt = `Фото ${guide.fullName}`;
            avatar.style.display = 'block';
            const initialsElement = document.querySelector('.profile-avatar-initials');
            if (initialsElement) {
                initialsElement.style.display = 'none';
            }
        } else {
            // Если фото нет, показываем инициалы
            const names = guide.fullName.split(' ');
            const initials = (names[0][0] || '') + (names[1] ? names[1][0] : '');
            const initialsElement = document.querySelector('.profile-avatar-initials');
            if (initialsElement) {
                initialsElement.textContent = initials;
                initialsElement.style.display = 'flex';
            }
            avatar.style.display = 'none';
        }
    }

    // 3. Обновляем контакты и основную информацию
    const infoGrid = document.querySelector('.info-grid');
    if (infoGrid) {
        const infoValues = infoGrid.querySelectorAll('.info-value');
        if (infoValues.length >= 4) {
            infoValues[0].textContent = guide.contacts.phone || 'Нет данных';
            infoValues[1].textContent = guide.category || 'Нет данных';
            infoValues[2].textContent = guide.license.issuingAuthority || 'Нет данных';
            infoValues[3].textContent = guide.license.number || 'Нет данных';
        }
    }

    // 4. Обновляем маршруты
    const routeContainer = document.querySelector('.route-points');
    if (routeContainer && guide.routes && guide.routes[0]) {
        routeContainer.innerHTML = '';
        guide.routes[0].points.forEach((point, index) => {
            const pointElement = document.createElement('span');
            pointElement.className = 'route-point';
            pointElement.textContent = point;
            routeContainer.appendChild(pointElement);

            if (index < guide.routes[0].points.length - 1) {
                const arrow = document.createElement('span');
                arrow.style.color = '#666';
                arrow.style.marginLeft = '8px';
                routeContainer.appendChild(arrow);
            }
        });
    }

    // 5. Обновляем дополнительные данные
    const profileCards = document.querySelectorAll('.profile-card');
    if (profileCards.length >= 3) {
        const additionalInfoValues = profileCards[2].querySelectorAll('.info-value');
        if (additionalInfoValues.length >= 4) {
            additionalInfoValues[0].textContent = guide.additionalInfo.inn || 'Нет данных';
            additionalInfoValues[1].textContent = guide.additionalInfo.examType || 'Нет данных';
            additionalInfoValues[2].textContent = guide.additionalInfo.entityType || 'Нет данных';
            additionalInfoValues[3].textContent = guide.license.issueDate || 'Нет данных';
        }
    }

    // 6. Обновляем историю изменений
    const historyContainer = document.getElementById('history-container');
    if (historyContainer && guide.history) {
        historyContainer.innerHTML = '';
        guide.history.forEach(item => {
            const itemElement = document.createElement('div');
            itemElement.className = 'info-item';

            const label = document.createElement('span');
            label.className = 'info-label';
            label.textContent = item.date;

            const value = document.createElement('div');
            value.className = 'info-value';
            value.textContent = item.action;

            itemElement.appendChild(label);
            itemElement.appendChild(value);
            historyContainer.appendChild(itemElement);
        });
    }

    // 7. Обновляем бейджи
    const badgesContainer = document.getElementById('badges-container');
    if (badgesContainer) {
        badgesContainer.innerHTML = '';

        if (guide.license && guide.license.status) {
            const licenseBadge = document.createElement('span');
            licenseBadge.className = isLicenseRevoked ? 'badge badge-revoked' : 'badge';
            licenseBadge.textContent = guide.license.status;
            badgesContainer.appendChild(licenseBadge);
        }

        if (guide.tags) {
            guide.tags.forEach(tag => {
                const badge = document.createElement('span');
                badge.className = 'badge';
                badge.textContent = tag;
                badgesContainer.appendChild(badge);
            });
        }
    }
}

function safeSetText(selector, text) {
    const element = document.querySelector(selector);
    if (element) {
        element.textContent = text || 'Нет данных';
    }
}

// Загрузка данных
document.addEventListener('DOMContentLoaded', () => {
    const loader = document.getElementById('loader');
    loader.classList.remove('hidden');

    const guideId = "U191KK";

    getGuideById(guideId)
        .then(guide => {
            updateUI(guide);
        })
        .catch(error => {
            console.error("Ошибка:", error.message);
        })
        .finally(() => {
            loader.classList.add('hidden');
        });
});
</script>
</body>
</html>
